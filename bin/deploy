#!/usr/bin/env ruby

require 'fileutils'

# path to your application root.
APP_ROOT = File.expand_path("..", __dir__)

TERRAFORM_ROOT = File.expand_path('infrastructure/terraform-aws-lite-poll', APP_ROOT)

def system!(*args)
  system(*args) || abort("\n== Command #{args} failed ==")
end

image_repo_url = nil
FileUtils.chdir TERRAFORM_ROOT do
  system! "terraform apply -var=db_password=#{ENV.fetch('DB_PASSWORD')} --auto-approve"
  image_repo_url = `terraform output image_repo_url`
end
